FROM alpine:3.18

# Install core utilities and development tools
RUN apk add --no-cache \
    bash \
    git \
    openssh-client \
    curl \
    ca-certificates \
    nodejs \
    npm \
    python3 \
    py3-pip \
    ruby \
    ruby-bundler \
    go \
    && gem install bundler

# Install GitHub CLI
RUN curl -fsSL https://github.com/cli/cli/releases/download/v2.40.1/gh_2.40.1_linux_amd64.tar.gz \
    | tar -xz -C /tmp \
    && mv /tmp/gh_2.40.1_linux_amd64/bin/gh /usr/local/bin/ \
    && rm -rf /tmp/gh_*

# Create app directory
RUN mkdir -p /app

# Copy dependency detection script
COPY scripts/detect-and-install.sh /app/detect-and-install.sh
RUN chmod +x /app/detect-and-install.sh

# Set working directory
WORKDIR /workspace

# Default entrypoint
ENTRYPOINT ["bash"]
